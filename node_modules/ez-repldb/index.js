let _url=process.env.REPLIT_DB_URL||"";const _host="kv.replit.com";let _path=_url.substr(21);const _cache={};let _cachingEnabled=!0;module.exports={get url(){return _url},set url(value){return _path=(_url=value).substr(21),_url},get host(){return _host},set host(value){return _host},get path(){return _path},set path(value){return _path},get cache(){return _cache},set cache(value){return _cache},get cachingEnabled(){return _cachingEnabled},set cachingEnabled(value){return"boolean"==typeof value&&(_cachingEnabled=value),_cachingEnabled},get:(...t)=>new Promise(function(e){if(0===t.length)e(null);else if(1===t.length){if(_cachingEnabled&&t[0]in _cache)return e(_cache[t[0]]);fetch(_url+"/"+encodeURIComponent(t[0].toString())).then(function(t){return t.text()}).then(function(n){e(_cache[t[0]]=JSON.parse(n))}).catch(function(){e(null)})}else{let n=Array(t.length);for(let r=0;r<t.length;r++){let c=r;n[c]=new Promise(function(e){if(_cachingEnabled&&t[c]in _cache)return e(_cache[t[c]]);fetch(_url+"/"+encodeURIComponent(t[c].toString())).then(function(t){return t.text()}).then(function(n){e(_cache[t[c]]=JSON.parse(n))}).catch(function(){e(null)})})}Promise.all(n).then(function(t){e(t)})}}),set(...t){let e=[];for(let n=0;n<t.length-1;n+=2)_cache[t[n]]=t[n+1],e.push(encodeURIComponent(t[n].toString())+"="+encodeURIComponent(JSON.stringify(t[n+1])));return fetch(_url+"?"+e.join("&"),{method:"POST"}).then(function(){return!0}).catch(function(){return!1})},delete:(...t)=>new Promise(function(e){if(0===t.length)e(!0);else if(1===t.length)t[0]in _cache&&delete _cache[t[0]],fetch(_url+"/"+encodeURIComponent(t[0].toString()),{method:"DELETE"}).then(function(){e(!0)}).catch(function(){e(!1)});else{let n=Array(t.length);for(let r=0;r<t.length;r++)n[r]=new Promise(function(e){t[r]in _cache&&delete _cache[t[r]],fetch(_url+"/"+encodeURIComponent(t[r].toString()),{method:"DELETE"}).then(function(){e(!0)}).catch(function(){e(!1)})});Promise.all(n).then(function(t){e(t)})}}),list:(t="")=>fetch(_url+"?encode=true&prefix="+encodeURIComponent(t.toString())).then(function(t){return t.text()}).then(function(t){if(""===t)return[];let e=t.split("\n");for(let n=0;n<e.length;n++)e[n]=decodeURIComponent(e[n]);return e}).catch(function(){return[]}),getAll(){if(_cachingEnabled)return new Promise(function(t,e){let n={};for(let r in _cache)n[r]=_cache[r];t(n)});let t={};return fetch(_url+"?encode=true&prefix=").then(function(t){return t.text()}).then(function(e){if(""===e)return t;let n=e.split("\n");for(let r=0;r<n.length;r++)n[r]=decodeURIComponent(n[r]);let c=[];for(let u=0;u<n.length;u++){let l=n[u];c.push(fetch(_url+"/"+encodeURIComponent(l.toString())).then(function(t){return t.text()}).then(function(e){return _cache[l]=JSON.parse(e),t[l]=JSON.parse(e)}).catch(function(){return null}))}return Promise.all(c).then(function(){return t}).catch(function(){return t})}).catch(function(){return t})},cache:()=>fetch(_url+"?encode=true&prefix=").then(function(t){return t.text()}).then(function(t){if(""===t)return!0;let e=t.split("\n");for(let n=0;n<e.length;n++)e[n]=decodeURIComponent(e[n]);let r=[];for(let c=0;c<e.length;c++){let u=c;r.push(fetch(_url+"/"+encodeURIComponent(e[u].toString())).then(function(t){return t.text()}).then(function(t){return _cache[e[u]]=JSON.parse(t)}).catch(function(){return null}))}return Promise.all(r).then(function(){return!0}).catch(function(){return!1})}).catch(function(){return!1}),clear:()=>fetch(_url+"?encode=true&prefix=").then(function(t){return t.text()}).then(function(t){if(""===t)return[];let e=t.split("\n");for(let n=0;n<e.length;n++)e[n]=decodeURIComponent(e[n]);let r=[];for(let c=0;c<e.length;c++){let u=c;r.push(new Promise(function(t){fetch(_url+"/"+encodeURIComponent(e[u]),{method:"DELETE"}).then(function(){keys[u]in _cache&&delete _cache[keys[u]],t(!0)}).catch(function(){t(!1)})}))}return Promise.all(r).then(function(t){return t}).catch(function(t){return t})}),getObject(t){let e=[];for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(new Promise(function(e){fetch(_url+"/"+encodeURIComponent(n)).then(function(t){return t.text()}).then(function(r){_cache[n]=t[n]=JSON.parse(r),e()}).catch(function(){_cache[n]=t[n]=t[n]||null,e()})}));return Promise.all(e).then(function(){return t}).catch(function(){return t})},applyObject(t){let e=[];for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(_cache[n]=t[n],e.push(n+"="+decodeURIComponent(JSON.stringify(t[n]))));return fetch(_url+"?"+e.join("&"),{method:"POST"}).then(function(){return!0}).catch(function(){return!1})},import:t=>fetch(t+"?encode=true&prefix=").then(function(t){return t.text()}).then(function(e){if(""===e)return console.log("Input database is empty."),!0;let n=e.split("\n"),r=Array(n.length),c=[];for(let u=0;u<n.length;u++){let l=u;n[l]=decodeURIComponent(n[l]),c.push(fetch(t+"/"+encodeURIComponent(n[l])).then(function(t){return t.text()}).then(function(t){return _cache[n[l]]=r[l]=JSON.parse(t)}).catch(function(){return _cache[n[l]]=r[l]=null}))}return Promise.all(c).then(function(){let t=[];for(let e=0;e<n.length;e++)t.push(encodeURIComponent(n[e].toString())+"="+encodeURIComponent(JSON.stringify(r[e])));return fetch(_url+"?"+t.join("&"),{method:"POST"}).then(function(){console.log("Imported the following keys: "+n.map(function(t){return'"'+t+'"'}).join(", "));for(let t=0;t<r.length;t++)null!==r[t]&&(n.splice(t,1),r.splice(t,1));return n.length>0&&console.warn("The following keys returned null values (this may indicate an error at some point during the import process or in the processes that generated these keys in the first place): "+n.map(function(t){return'"'+t+'"'}).join(", ")),!0}).catch(function(){return console.warn("An unexpected error occurred attempting to set the key-value pairs in the current database."),!1})}).catch(function(){return console.warn("An unexpected error occurred reading from the input database (please ensure you use the correct URL)."),!1})}).catch(function(){return console.warn("An unexpected error occurred reading from the input database (please ensure you use the correct URL)."),!1})};